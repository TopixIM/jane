{:definitions {"jane.schema/topic" ["def" "topic" ["{}" [":id" "nil"] [":name" "nil"] [":time" "nil"] [":members" ["hash-set"]]]], "jane.updater.router/add-topic" ["defn" "add-topic" ["db" "op-data" "state-id" "op-id" "op-time"] ["update-in" "db" ["[]" ":states" "state-id" ":router"] ["fn" ["router"] ["assoc" "router" ":router" ["{}" [":name" ":add-topic"] [":params" "nil"]]]]]], "jane.main/-main" ["defn" "-main" [] ["nodejs/enable-util-print!"] ["let" [["server-ch" ["run-server!" ["{}" ":port" "5020"]]]] ["go-loop" ["[]"] ["let" [[["[]" "op" "op-data" "state-id" "op-id" "op-time"] ["<!" "server-ch"]] ["new-db" ["updater" "@writer-db-ref" "op" "op-data" "state-id" "op-id" "op-time"]]] ["println" "|event" "op" "op-data" "state-id" "op-id" "op-time"] ["reset!" "writer-db-ref" "new-db"] ["recur"]]] ["render-loop!"]] ["add-watch" "reader-db-ref" ":log" ["fn" []]] ["println" "|server started"]], "jane.view/render-scene" ["defn" "render-scene" ["db"] "db"], "jane.updater.user/login" ["defn" "login" ["db" "op-data" "state-id" "op-id" "op-time"] ["let" [[["[]" "username" "password"] "op-data"] ["state" ["get-in" "db" ["[]" ":states" "state-id"]]] ["target-entry" ["->>" [":users" "db"] ["filter" ["fn" ["entry"] ["let" [["user" ["val" "entry"]]] ["and" ["=" [":name" "user"] "username"]]]]] ["first"]]] ["target-user" ["if" ["some?" "target-entry"] ["val" "target-entry"] "nil"]]] ["println" "|target-user" "target-user"] ["if" ["some?" "target-user"] ["update-in" "db" ["[]" ":states" "state-id"] ["fn" ["state"] ["if" ["=" "password" [":password" "target-user"]] ["assoc" "state" ":user-id" [":id" "target-user"]] ["update" "state" ":notifications" ["fn" ["notifications"] ["conj" "notifications" ["{}" [":id" "op-id"] [":text" "|wrong password!"]]]]]]]] ["->" "db" ["assoc-in" ["[]" ":users" "op-id"] ["{}" [":id" "op-id"] [":name" "username"] [":password" "password"]]] ["assoc-in" ["[]" ":states" "state-id" ":user-id"] "op-id"]]]]], "jane.updater.team/create" ["defn" "create" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":teams" "op-id"] ["{}" [":name" "op-data"] [":id" "op-id"] [":time" "op-time"]]]], "jane.main/render-loop!" ["defn" "render-loop!" [] ["if" ["not=" "@reader-db-ref" "@writer-db-ref"] ["do" ["reset!" "reader-db-ref" "@writer-db-ref"] ["--" "println" "|render loop"] ["render-clients!" "@reader-db-ref" "render-scene" "render-view"]]] ["js/setTimeout" "render-loop!" "300"]], "jane.view/render-router" ["defn" "render-router" ["router" "state-id" "db"] ["case" [":name" "router"] [":home" "router"] [":team" ["let" [["team-id" ["get" "router" ":params"]]] ["->" "router" ["assoc" ":data" ["{}" [":team" ["get-in" "db" ["[]" ":teams" "team-id"]]]]] ["update" ":router" ["fn" ["router"] ["case" [":name" "router"] [":topic" ["let" [["topic-id" ["get" "router" ":params"]]] ["assoc" "router" ":data" ["get-in" "db" ["[]" ":topics" "topic-id"]]]]] "router"]]]]]] "router"]], "jane.main/reader-db-ref" ["defonce" "reader-db-ref" ["atom" "@writer-db-ref"]], "jane.view/render-view" ["defn" "render-view" ["state-id" "db"] ["let" [["state" ["get-in" "db" ["[]" ":states" "state-id"]]] ["user-id" [":user-id" "state"]] ["router" [":router" "state"]]] ["{}" [":state" "state"] [":user" ["if" ["some?" "user-id"] ["get-in" "db" ["[]" ":users" "user-id"]] "nil"]] [":teams" [":teams" "db"]] [":router" ["render-router" "router" "state-id" "db"]]]]], "jane.updater.topic/create" ["defn" "create" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":topics" "op-id"] ["{}" [":name" "op-data"] [":id" "op-id"] [":time" "op-time"] [":members" ["hash-set"]]]]], "jane.updater.core/updater" ["defn" "updater" ["db" "op" "op-data" "state-id" "op-id" "op-time"] ["let" [["handler" ["case" "op" [":state/connect" "state/connect"] [":state/disconnect" "state/disconnect"] [":user/login" "user/login"] [":team/create" "team/create"] [":router/team" "router/team"] [":router/add-topic" "router/add-topic"] [":topic/create" "topic/create"] ["do" ["println" "|found no handler for" "op"] "default-handler"]]]] ["handler" "db" "op-data" "state-id" "op-id" "op-time"]]], "jane.schema/team" ["def" "team" ["{}" [":name" "nil"] [":id" "nil"] [":time" "nil"] [":members" ["hash-set"]]]], "jane.schema/state" ["def" "state" ["{}" [":user-id" "nil"] [":id" "nil"] [":nickname" "nil"] [":router" ["{}" [":name" ":home"] [":params" "nil"] [":data" "nil"]]] [":notifications" ["[]"]]]], "jane.main/on-jsload" ["defn" "on-jsload" [] ["println" "|code updated."] ["render-clients!" "@reader-db-ref" "render-scene" "render-view"]], "jane.updater.state/disconnect" ["defn" "disconnect" ["db" "op-data" "state-id" "op-id" "op-time"] ["update" "db" ":states" ["fn" ["state"] ["dissoc" "state" "state-id"]]]], "jane.main/writer-db-ref" ["defonce" "writer-db-ref" ["atom" "schema/database"]], "jane.schema/database" ["def" "database" ["{}" [":states" ["{}"]] [":users" ["{}"]] [":teams" ["{}"]] [":messages" ["{}"]] [":topics" ["{}"]]]], "jane.schema/user" ["def" "user" ["{}" [":name" "nil"] [":id" "nil"] [":nickname" "nil"]]], "jane.updater.core/default-handler" ["defn" "default-handler" ["db" "op-data" "state-id" "op-id" "op-time"] "db"], "jane.updater.state/connect" ["defn" "connect" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":states" "state-id"] ["merge" "schema/state" ["{}" [":id" "state-id"]]]]], "jane.updater.router/team" ["defn" "team" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":states" "state-id" ":router"] ["{}" [":name" ":team"] [":params" "op-data"]]]]}, :namespaces {"jane.updater.team" ["ns" "jane.updater.team"], "jane.updater.user" ["ns" "jane.updater.user"], "jane.updater.router" ["ns" "jane.updater.router"], "jane.main" ["ns" "jane.main" [":require" ["[]" "cljs.nodejs" ":as" "nodejs"] ["[]" "jane.schema" ":as" "schema"] ["[]" "cumulo-server.core" ":refer" ["[]" "run-server!" "render-clients!"]] ["[]" "jane.updater.core" ":refer" ["[]" "updater"]] ["[]" "jane.view" ":refer" ["[]" "render-view" "render-scene"]] ["[]" "cljs.core.async" ":refer" ["[]" "<!"]]] [":require-macros" ["[]" "cljs.core.async.macros" ":refer" ["[]" "go-loop"]]]], "jane.updater.state" ["ns" "jane.updater.state" [":require" ["[]" "jane.schema" ":as" "schema"]]], "jane.view" ["ns" "jane.view" [":require" ["[]" "jane.schema" ":as" "schema"]]], "jane.schema" ["ns" "jane.schema"], "jane.updater.core" ["ns" "jane.updater.core" [":require" ["[]" "jane.updater.state" ":as" "state"] ["[]" "jane.updater.user" ":as" "user"] ["[]" "jane.updater.team" ":as" "team"] ["[]" "jane.updater.router" ":as" "router"] ["[]" "jane.updater.topic" ":as" "topic"]]], "jane.updater.topic" ["ns" "jane.updater.topic"]}, :main-definition nil, :procedures {"jane.updater.team" [], "jane.updater.user" [], "jane.updater.router" [], "jane.main" [["set!" "*main-cli-fn*" "-main"]], "jane.updater.state" [], "jane.view" [], "jane.schema" [], "jane.updater.core" [], "jane.updater.topic" []}}